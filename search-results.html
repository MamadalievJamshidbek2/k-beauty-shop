<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qidiruv natijalari - K-BEAUTY</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    .search-header { max-width: 1200px; margin: 40px auto; padding: 0 40px; }
    .search-header h1 { font-size: 32px; margin-bottom: 10px; color: #111; }
    .search-info { color: #666; font-size: 16px; margin-bottom: 30px; }
    .search-bar-container { margin-bottom: 40px; }
    .search-bar-large { width: 100%; max-width: 600px; padding: 15px 20px; border: 2px solid #ddd; border-radius: 30px; font-size: 16px; outline: none; transition: border-color 0.3s; }
    .search-bar-large:focus { border-color: #111; }
    .back-link { display: inline-block; margin: 30px 40px 0; color: #111; text-decoration: none; font-weight: 500; transition: color 0.3s; }
    .back-link:hover { color: #c2925e; }
    .loading { text-align: center; padding: 60px 20px; color: #666; font-size: 18px; }
  </style>
</head>
<body>
  <a href="index.html" class="back-link">‚Üê Bosh sahifaga qaytish</a>

  <div class="search-header">
    <h1>Qidiruv natijalari</h1>
    <div class="search-info" id="searchInfo">Qidirmoqdasiz...</div>
    
    <div class="search-bar-container">
      <input type="text" id="searchBar" class="search-bar-large" placeholder="Mahsulot, brand yoki narx bo'yicha qidirish...">
    </div>

    <div class="filter-controls">
      <div class="filter-group">
        <label>Brand:</label>
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="filterByBrand('all')">Barchasi</button>
          <button class="filter-btn" onclick="filterByBrand('LOE')">LOE</button>
          <button class="filter-btn" onclick="filterByBrand('SW19')">SW19</button>
          <button class="filter-btn" onclick="filterByBrand('BTSO')">BTSO</button>
          <button class="filter-btn" onclick="filterByBrand('GRANHAND')">GRANHAND</button>
          <button class="filter-btn" onclick="filterByBrand('TAMBURINS')">TAMBURINS</button>
        </div>
      </div>
      
      <div class="filter-group">
        <label>Narx:</label>
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="filterByPrice('all')">Barchasi</button>
          <button class="filter-btn" onclick="filterByPrice(0, 30)">$0 - $30</button>
          <button class="filter-btn" onclick="filterByPrice(30, 50)">$30 - $50</button>
          <button class="filter-btn" onclick="filterByPrice(50, 100)">$50+</button>
        </div>
      </div>

      <div class="filter-group">
        <label>Saralash:</label>
        <select id="sortSelect" class="sort-select" onchange="sortResults(this.value)">
          <option value="default">Standart</option>
          <option value="price-low">Narx: Pastdan yuqoriga</option>
          <option value="price-high">Narx: Yuqoridan pastga</option>
          <option value="rating">Reyting bo'yicha</option>
        </select>
      </div>
    </div>
  </div>

  <section class="section">
    <div class="products" id="searchResults">
      <div class="loading">Yuklanmoqda...</div>
    </div>
    
    <div id="noResults" class="no-results" style="display: none;">
      <p>üîç Hech narsa topilmadi</p>
      <p style="color: #999; font-size: 16px;">Boshqa so'z bilan qidirib ko'ring</p>
    </div>
  </section>

  <div id="cartModal" class="modal">
    <div class="modal-content cart-card">
      <button class="close x-btn" id="closeCart">&times;</button>
      <h2>Savatcha</h2>
      <div id="cartItems" class="cart-items"></div>
      <div class="cart-footer">
        <div class="cart-totals">
          <div>Subtotal:</div>
          <div id="cartSubtotal">$0.00</div>
        </div>
        <div class="cart-actions">
          <button id="clearCartBtn" class="btn-ghost">Tozalash</button>
          <a id="goToCheckout" href="checkout.html" class="btn-primary">Checkout</a>
        </div>
      </div>
    </div>
  </div>

  <div id="overlay"></div>
  <button id="cartBtn" style="position:fixed;bottom:30px;right:30px;width:60px;height:60px;border-radius:50%;background:#111;color:white;border:none;font-size:24px;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,0.3);z-index:999;">üõí</button>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h3 class="footer-logo">K-BEAUTY</h3>
        <p class="footer-desc">Premium Korean luxury perfumes</p>
      </div>
      <div class="footer-section">
        <h4 class="footer-title">Havolalar</h4>
        <ul class="footer-links">
          <li><a href="parfum.html">Bosh sahifa</a></li>
          <li><a href="about.html">Biz haqimizda</a></li>
          <li><a href="contact.html">Bog'lanish</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 K-BEAUTY. Barcha huquqlar himoyalangan.</p>
    </div>
  </footer>

  <button id="scrollToTop" class="scroll-to-top">‚Üë</button>

  <!-- ‚úÖ JS FAYLLAR ULANDI -->
  <script src="products-data.js"></script>
  <script src="footer-scroll.js"></script>
  
  <script>
    let currentResults = [];
    let currentQuery = '';
    let currentBrandFilter = 'all';
    let currentPriceFilter = { min: 'all', max: 'all' };

    function getSearchQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get('q') || '';
    }

    function renderProducts(products) {
      const container = document.getElementById('searchResults');
      const noResults = document.getElementById('noResults');
      
      if (products.length === 0) {
        container.innerHTML = '';
        noResults.style.display = 'block';
        return;
      }

      noResults.style.display = 'none';
      container.innerHTML = '';

      products.forEach(product => {
        const productEl = document.createElement('div');
        productEl.className = 'product';
        productEl.dataset.name = product.name;
        productEl.dataset.price = product.price;
        productEl.dataset.rating = product.rating;
        productEl.dataset.img = product.img;
        productEl.dataset.productId = product.id;

        let priceHTML = `<p class="price">$${product.price}`;
        if (product.oldPrice) {
          priceHTML += ` <span class="old-price">$${product.oldPrice}</span>`;
          priceHTML += ` <span class="discount">-${product.discount}%</span>`;
        }
        priceHTML += `</p>`;

        productEl.innerHTML = `
          <img src="${product.img}" alt="${product.name}">
          <h3>${product.name}</h3>
          <div class="rating">‚≠ê ${product.rating}/5</div>
          ${priceHTML}
          <button class="add-to-cart-btn small">Savatchaga qo'shish</button>
        `;

        productEl.onclick = (e) => {
          if (!e.target.closest('.add-to-cart-btn')) {
            window.location.href = `product-detail.html?id=${product.id}`;
          }
        };

        container.appendChild(productEl);
      });

      const searchInfo = document.getElementById('searchInfo');
      if (currentQuery) {
        searchInfo.textContent = `"${currentQuery}" uchun ${products.length} ta mahsulot topildi`;
      } else {
        searchInfo.textContent = `Jami ${products.length} ta mahsulot`;
      }
    }

    function performSearch(query) {
      currentQuery = query;
      let results = globalSearch(query);
      
      if (currentBrandFilter !== 'all') {
        results = results.filter(p => p.brand === currentBrandFilter);
      }
      
      if (currentPriceFilter.min !== 'all') {
        results = filterByPriceRange(results, currentPriceFilter.min, currentPriceFilter.max);
      }

      currentResults = results;
      renderProducts(results);
    }

    function filterByBrand(brand) {
      currentBrandFilter = brand;
      document.querySelectorAll('.filter-group:nth-child(1) .filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      performSearch(currentQuery);
    }

    function filterByPrice(min, max) {
      currentPriceFilter = { min, max };
      document.querySelectorAll('.filter-group:nth-child(2) .filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      performSearch(currentQuery);
    }

    function sortResults(sortType) {
      const sorted = sortProducts(currentResults, sortType);
      renderProducts(sorted);
    }

    const searchBar = document.getElementById('searchBar');
    let searchTimeout;
    searchBar.addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => performSearch(e.target.value), 300);
    });

    window.addEventListener('DOMContentLoaded', () => {
      const query = getSearchQuery();
      searchBar.value = query;
      performSearch(query);
      setupCartSystem();
    });

    function setupCartSystem() {
      const CART_KEY = 'myshop_cart_v1';
      let cart = [];

      function loadCart() {
        try { cart = JSON.parse(localStorage.getItem(CART_KEY)) || []; } catch(e) {}
      }

      function saveCart() { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

      function addToCart(product) {
        const idx = cart.findIndex(i => i.name === product.name);
        if (idx >= 0) cart[idx].qty += 1;
        else cart.push({...product, qty: 1});
        saveCart();
        renderCartItems();
      }

      function removeFromCart(idx) { cart.splice(idx, 1); saveCart(); renderCartItems(); }
      function changeQty(idx, delta) { cart[idx].qty = Math.max(1, cart[idx].qty + delta); saveCart(); renderCartItems(); }
      function clearCart() { cart = []; saveCart(); renderCartItems(); }

      function renderCartItems() {
        const container = document.getElementById('cartItems');
        const subtotal = document.getElementById('cartSubtotal');
        container.innerHTML = '';
        
        if (cart.length === 0) {
          container.innerHTML = '<p>Savatcha bo\'sh</p>';
          subtotal.textContent = '$0.00';
          return;
        }

        let total = 0;
        cart.forEach((item, idx) => {
          total += item.price * item.qty;
          container.innerHTML += `
            <div class="cart-item">
              <img src="${item.img}" alt="${item.name}">
              <div class="meta">
                <h4>${item.name}</h4>
                <div class="small muted">$${item.price} each</div>
              </div>
              <div style="text-align:right">
                <div class="qty-controls">
                  <button onclick="window.changeQty(${idx}, -1)">-</button>
                  <span>${item.qty}</span>
                  <button onclick="window.changeQty(${idx}, 1)">+</button>
                  <button class="remove-btn" onclick="window.removeFromCart(${idx})">O'chirish</button>
                </div>
                <div style="font-weight:600">$${(item.price * item.qty).toFixed(2)}</div>
              </div>
            </div>
          `;
        });
        subtotal.textContent = '$' + total.toFixed(2);
      }

      document.body.addEventListener('click', (e) => {
        const btn = e.target.closest('.add-to-cart-btn');
        if (!btn) return;
        e.stopPropagation();
        
        const prod = btn.closest('.product');
        if (!prod) return;
        
        addToCart({
          name: prod.dataset.name,
          price: parseFloat(prod.dataset.price),
          img: prod.dataset.img
        });
        
        btn.textContent = 'Qo\'shildi ‚úì';
        setTimeout(() => btn.textContent = 'Savatchaga qo\'shish', 900);
      });

      document.getElementById('cartBtn').onclick = () => {
        renderCartItems();
        document.getElementById('cartModal').classList.add('active');
        document.getElementById('overlay').classList.add('active');
      };

      document.getElementById('closeCart').onclick = () => {
        document.getElementById('cartModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
      };

      document.getElementById('overlay').onclick = () => {
        document.getElementById('cartModal').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
      };

      document.getElementById('clearCartBtn').onclick = () => clearCart();

      window.changeQty = changeQty;
      window.removeFromCart = removeFromCart;

      loadCart();
    }
  </script>
  <script src="api-service.js"></script>
<script src="loading-system.js"></script>
<script src="auth-system-backend.js"></script>
<script src="products-loader.js"></script>
<script src="cart-system-backend.js"></script>
<script src="footer-scroll.js"></script>
</body>
</html>